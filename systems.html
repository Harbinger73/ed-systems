<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Elite Dangerous Systems</title>
	<link href="external/jquery-ui.css" rel="stylesheet">
	<link href="trilateration.css" rel="stylesheet">
	<script src="external/jquery-2.1.1.js"></script>
	<script src="external/stupidtable.min.js"></script>
	<script src="trilateration.js"></script>
<script>
var systems = null;
var selected = null;

$(document).ready(function () {
	$.getJSON('systems.json', function(data) {
		systems = data;

		var d, i;
		for (i = 0; i < systems.length; i++) {
			$('<tr>')
				.attr('system', i)
				.click(function() {selectSystem(this)})
				.append($('<td>').text(systems[i].name))
				.append($('<td>').text(systems[i].x))
				.append($('<td>').text(systems[i].y))
				.append($('<td>').text(systems[i].z))
				.append($('<td>'))
				.appendTo('#tableDiv tbody');
		}
		$('#tableDiv table').stupidtable().bind('aftertablesort', updateSortArrow);
		selectSystem($('#tableDiv tr[system]')[0]);
	});
});

function selectSystem(row) {
	if (selected === row) return;

	if (selected) {
		$(selected).removeClass('selected');
	}
	
	selected = row;
	$(selected).addClass('selected');
	
	// recalculate distances
	if (!selected.hasAttribute('system')) return;
	var s0 = systems[selected.getAttribute('system')];
	$('#tableDiv tr').each(function(i, r) {
		if (!r.hasAttribute('system')) {
			$(r).children('th').last().text('Distance to '+s0.name);
			return;
		}
		var s = systems[r.getAttribute('system')];
		$(r).children('td').last().text((dist(s0, s)).toFixed(3));
	});
}

</script>
</head>
<body>
	<div class="ui-widget" id="tableDiv">
		<table>
			<thead>
				<tr>
					<th data-sort="string-ins">System</th>
					<th data-sort="float">X</th>
					<th data-sort="float">Y</th>
					<th data-sort="float">Z</th>
					<th data-sort="float">Distance</th>
				</tr>
			</thead>
			<tbody>
			</tbody>
		</table>
	</div>
</body>
</html>
